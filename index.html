<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Menu Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        /* All your existing CSS styles remain the same */
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Roboto Condensed', sans-serif;
            background-color: #fdfaf3;
            color: #4a2c2a;
        }
        .font-display {
            font-family: 'Lilita One', cursive;
        }
        .menu-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1vh 2vw 1.5vh;
        }
        .menu-grid {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2vw;
        }
        .menu-category {
            font-size: 2.5vw;
            margin-bottom: 0.5em;
            border-bottom: 4px solid #c5a07e;
            padding-bottom: 0.3em;
            text-transform: uppercase;
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            font-size: 1.2vw;
            line-height: 1.5;
            margin-top: 0.5vh;
        }
        .menu-item-name {
            text-transform: uppercase;
        }
        .menu-item-price {
            font-weight: 700;
            white-space: nowrap;
            padding-left: 1vw;
        }
        .description {
            font-size: 1vw;
            text-transform: none;
            color: #6d4c41;
            line-height: 1.4;
            margin-top: 0.5vh;
        }
        .header-title {
            font-size: 5vw;
            color: #d4af37;
        }
        .asterisk {
            font-family: 'Lilita One', cursive;
            color: #c5a07e;
            font-size: 2.5vw;
        }
        .footer-items {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5vw;
            margin-top: 1vh;
        }
        .footer-item {
            text-align: center;
        }
        .footer-item img {
            border: 4px solid #c5a07e;
            border-radius: 0.5rem;
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
        }
        .footer-item-title {
            font-size: 1.3vw;
            font-weight: 700;
            margin-top: 0.5vh;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div class="menu-container">
        <header class="text-center relative pb-1">
            <h1 class="font-display header-title">MENÃš</h1>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 left-8">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 left-20">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 right-8">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 right-20">*</div>
        </header>

        <div id="menu-grid" class="menu-grid">
            </div>

        <div id="footer-items" class="footer-items">
            </div>
    </div>

<script>
    // ### PASTE YOUR GOOGLE SHEET URL HERE ###
    const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbfxhYys7zgw7Tw-pdkAZnvQXUEDglxte9orQzkBqbFJBSdPNk-K3otQ9d_2eIcMUXcCb21IMAObpz/pub?output=csv';

    document.addEventListener('DOMContentLoaded', () => {
        Papa.parse(googleSheetUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: (results) => {
                const data = results.data;
                const menuData = data.filter(row => row.Category && row.Category.trim() !== 'Footer');
                const footerData = data.filter(row => row.Category && row.Category.trim() === 'Footer');
                
                displayMenu(menuData);
                displayFooter(footerData);
            },
            error: (error) => {
                console.error('Error fetching or parsing sheet data:', error);
                document.getElementById('menu-grid').innerHTML = '<p>Error loading menu. Please check the Google Sheet URL and settings.</p>';
            }
        });
    });

    // ### REVISED FUNCTION ###
    function displayMenu(data) {
        const menuGrid = document.getElementById('menu-grid');
        const maxColumns = 4;

        // Step 1: Group all items by their category.
        const categories = {};
        data.forEach(item => {
            if (!item.Category) return; // Skip items with no category
            if (!categories[item.Category]) {
                categories[item.Category] = []; // Create an array for the new category
            }
            categories[item.Category].push(item); // Add the item to its category group
        });

        // Step 2: Prepare the columns and distribute the category groups into them.
        const columnsHtml = Array(maxColumns).fill(''); // Create an array of empty strings for our columns
        const categoryNames = Object.keys(categories);

        categoryNames.forEach((categoryName, index) => {
            const columnIndex = index % maxColumns; // Distribute categories evenly (0, 1, 2, 3, 0, 1, ...)
            
            // Build the HTML for the entire category block
            let categoryHtml = `<h2 class="font-display menu-category">${categoryName}</h2>`;
            categories[categoryName].forEach(item => {
                categoryHtml += `
                    <div class="menu-item">
                        <span class="menu-item-name">${item.ItemName}</span>
                        ${item.Price ? `<span class="menu-item-price">${item.Price}</span>` : ''}
                    </div>
                    ${item.Description ? `<p class="description">${item.Description}</p>` : ''}
                `;
            });
            
            // Add this category's HTML to the appropriate column
            columnsHtml[columnIndex] += categoryHtml;
        });

        // Step 3: Build the final grid HTML and inject it into the page.
        menuGrid.innerHTML = columnsHtml.map(columnContent => 
            `<div class="menu-column">${columnContent}</div>`
        ).join('');
    }


    function displayFooter(data) {
        const footerGrid = document.getElementById('footer-items');
        let footerHtml = '';
        data.forEach(item => {
            if (item.ImageURL) {
                footerHtml += `
                    <div class="footer-item">
                        <img src="${item.ImageURL}" alt="${item.ItemName}">
                        <h3 class="font-display footer-item-title">${item.ItemName} ${item.Price || ''}</h3>
                    </div>
                `;
            }
        });
        footerGrid.innerHTML = footerHtml;
    }

</script>

</body>
</html>