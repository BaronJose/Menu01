<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Menu Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Roboto Condensed', sans-serif;
            background-color: #fdfaf3;
            color: #4a2c2a;
        }
        .font-display {
            font-family: 'Lilita One', cursive;
        }
        .menu-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1vh 2vw 1.5vh;
        }
        .menu-grid {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2vw;
        }
        .menu-category {
            font-size: 1.5vw;
            margin-bottom: 0.5em;
            border-bottom: 4px solid #c5a07e;
            padding-bottom: 0.3em;
            text-transform: uppercase;
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            font-size: 1.2vw;
            line-height: 1.5;
            margin-top: 0.5vh;
        }
        .menu-item-name {
            text-transform: uppercase;
        }
        .menu-item-price {
            font-weight: 700;
            white-space: nowrap;
            padding-left: 1vw;
        }
        .description {
            font-size: 1vw;
            text-transform: none;
            color: #6d4c41;
            line-height: 1.4;
            margin-top: 0.5vh;
        }
        .header-title {
            font-size: 3vw;
            color: #d4af37;
        }
        .asterisk {
            font-family: 'Lilita One', cursive;
            color: #c5a07e;
            font-size: 2.5vw;
        }

        /* --- STYLES FOR ROTATING FOOTER --- */
        .footer-wrapper {
            width: 100%;
            overflow: hidden; /* Hides the items that are off-screen */
            margin-top: 1vh;
        }

        .footer-items {
            display: flex; /* Aligns items in a row */
            width: fit-content; /* Container width is based on its content */
            /* Animation will be applied by JavaScript */
            animation-name: scroll;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        .footer-item {
            text-align: center;
            flex-shrink: 0; /* Prevents items from shrinking */
            width: 16.6vw; /* 100vw / 6 items visible at a time */
            padding: 0 0.75vw; /* Corresponds to the old gap */
            box-sizing: border-box;
        }
        
        .footer-item img {
            border: 4px solid #c5a07e;
            border-radius: 0.5rem;
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
        }
        .footer-item-title {
            font-size: 1.3vw;
            font-weight: 700;
            margin-top: 0.5vh;
            text-transform: uppercase;
        }

        /* The animation that moves the items */
        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                /* Moves the container left by the width of the original set of items */
                transform: translateX(-50%);
            }
        }

    </style>
</head>
<body>

    <div class="menu-container">
        <header class="text-center relative pb-1">
            <h1 class="font-display header-title">MENÃš</h1>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 left-8">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 left-20">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 right-8">*</div>
            <div class="asterisk absolute top-1/2 -translate-y-1/2 right-20">*</div>
        </header>

        <div id="menu-grid" class="menu-grid"></div>

        <div class="footer-wrapper">
            <div id="footer-items" class="footer-items"></div>
        </div>
    </div>

<script>
    const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbfxhYys7zgw7Tw-pdkAZnvQXUEDglxte9orQzkBqbFJBSdPNk-K3otQ9d_2eIcMUXcCb21IMAObpz/pub?output=csv';

    document.addEventListener('DOMContentLoaded', () => {
        Papa.parse(googleSheetUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: (results) => {
                const data = results.data;
                const menuData = data.filter(row => row.Category && row.Category.trim() !== 'Footer');
                const footerData = data.filter(row => row.Category && row.Category.trim() === 'Footer');
                
                displayMenu(menuData);
                displayFooter(footerData);
            },
            error: (error) => {
                console.error('Error fetching or parsing sheet data:', error);
                document.getElementById('menu-grid').innerHTML = '<p>Error loading menu.</p>';
            }
        });
    });

    // ### REVISED FUNCTION ###
    function displayMenu(data) {
        const menuGrid = document.getElementById('menu-grid');
        const maxColumns = 4;
        const categories = {};
        data.forEach(item => {
            if (!item.Category) return;
            if (!categories[item.Category]) {
                categories[item.Category] = [];
            }
            categories[item.Category].push(item);
        });

        const columnsHtml = Array(maxColumns).fill('');
        const categoryNames = Object.keys(categories);

        categoryNames.forEach((categoryName, index) => {
            const columnIndex = index % maxColumns;
            
            // --- NEW CHANGE IS HERE ---
            let categoryTitle = categoryName;
            let categoryDescription = '';

            // If the category is "Tortas", prepare the shared description
            if (categoryName === 'Tortas' && categories[categoryName][0]?.Description) {
                categoryDescription = `<div class="description">${categories[categoryName][0].Description}</div>`;
            }
            
            // Build the H2 tag with the title and the (optional) description inside it
            let categoryHtml = `<h2 class="font-display menu-category">${categoryTitle}${categoryDescription}</h2>`;

            // Loop through the items in the category
            categories[categoryName].forEach(item => {
                categoryHtml += `
                    <div class="menu-item">
                        <span class="menu-item-name">${item.ItemName}</span>
                        ${item.Price ? `<span class="menu-item-price">${item.Price}</span>` : ''}
                    </div>
                `;
                // Add individual descriptions ONLY if the category is NOT "Tortas"
                if (categoryName !== 'Tortas' && item.Description) {
                    categoryHtml += `<p class="description">${item.Description}</p>`;
                }
            });
            
            columnsHtml[columnIndex] += categoryHtml;
        });

        menuGrid.innerHTML = columnsHtml.map(columnContent => 
            `<div class="menu-column">${columnContent}</div>`
        ).join('');
    }


    function displayFooter(data) {
        if (data.length === 0) return; 

        const footerContainer = document.getElementById('footer-items');
        let footerHtml = '';
        data.forEach(item => {
            if (item.ImageURL) {
                footerHtml += `
                    <div class="footer-item">
                        <img src="${item.ImageURL}" alt="${item.ItemName}">
                        <h3 class="font-display footer-item-title">${item.ItemName || ''} ${item.Price || ''}</h3>
                    </div>
                `;
            }
        });

        // Duplicate the items to create a seamless loop
        footerContainer.innerHTML = footerHtml + footerHtml;

        // Calculate and set the animation duration to maintain a consistent speed
        const secondsPerItem = 4; // Adjust this value to make the scroll faster or slower
        const duration = data.length * secondsPerItem;
        footerContainer.style.animationDuration = `${duration}s`;
    }

</script>

</body>
</html>